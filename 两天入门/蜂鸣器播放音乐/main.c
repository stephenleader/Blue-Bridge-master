#include <REG52.H>    
#include <INTRINS.H>    
//???12MHZ      
//?????????????,???????????????;     

sbit Beep =  P0^6;
unsigned char p,m;   //m???????    
unsigned char i=0;   
   
unsigned char n=0;  //n???????    
unsigned char code music_tab[] ={   		
//???: ????, ????, ????, ????,
0x0F,0x01, 0x15,0x02, 0x16,0x02, 0x17,0x66, 0x18,0x03,
0x17,0x02, 0x15,0x02, 0x16,0x01, 0x15,0x02, 0x10,0x02,
0x15,0x00, 0x0F,0x01, 0x15,0x02, 0x16,0x02, 0x17,0x02,
0x17,0x03, 0x18,0x03, 0x19,0x02, 0x15,0x02, 0x18,0x66,
0x17,0x01, 0x19,0x02, 0x16,0x03, 0x17,0x03, 0x16,0x00,
0x17,0x03, 0x19,0x02, 0x1B,0x02, 0x1B,0x70, 0x1A,0x03,
0x1A,0x01, 0x19,0x02, 0x19,0x03, 0x1A,0x03, 0x1B,0x02,
0x1A,0x0D, 0x19,0x03, 0x17,0x00, 0x18,0x66, 0x18,0x03,
0x19,0x02, 0x1A,0x02, 0x19,0x0C, 0x18,0x0D, 0x17,0x03,
0x16,0x01, 0x11,0x02, 0x11,0x03, 0x10,0x03, 0x0F,0x0C,
0x10,0x02, 0x15,0x00, 0x1F,0x01, 0x1A,0x01, 0x18,0x66,
0x19,0x03, 0x1A,0x01, 0x1B,0x02, 0x1B,0x03, 0x1B,0x03,
0x1B,0x0C, 0x1A,0x0D, 0x19,0x03, 0x17,0x00, 0x1F,0x01,
0x1A,0x01, 0x18,0x66, 0x19,0x01, 0x1A,0x01, 0x10,0x02,
0x10,0x03, 0x10,0x03, 0x1A,0x0C, 0x18,0x0D, 0x17,0x01,
0x16,0x00, 0x0F,0x01, 0x15,0x02, 0x16,0x02, 0x17,0x70,
0x18,0x03, 0x17,0x02, 0x15,0x03, 0x15,0x03, 0x16,0x66,
0x16,0x03, 0x16,0x02, 0x16,0x01, 0x15,0x03, 0x10,0x02,
0x10,0x01, 0x11,0x01, 0x11,0x66, 0x10,0x01, 0x0F,0x0C,
0x1A,0x02, 0x19,0x02, 0x16,0x03, 0x16,0x03, 0x18,0x66,
0x18,0x03, 0x18,0x02, 0x17,0x01, 0x16,0x03, 0x19,0x00,
0x00,0x00    
};   
   
void int0()  interrupt 1   //????0 ????    
{  TH0=0xd8;       //??10ms
   TL0=0xef;   
   n--;   
}   
   
void delay (unsigned char m)   //??????    
{   
 unsigned i=3*m;   
 while(--i);   
}   
   
void delayms(unsigned char a)  //???????    
{   
  while(--a);                  //??while(--a) ????while(a--); ?????????????????!    
}   
   
void main()   
{ 
  P2 = (P2 & 0x1f) | 0xa0; 
  TMOD&=0x0f;   
  TMOD|=0x01;   
  TH0=0xd8;
  TL0=0xef;   
  EA = 1;
  ET0 = 1; 
  TR0 = 1;  
play:   
   while(1)   
    {   
    a: p=music_tab[i];   
       if(p==0x00)       
			{i=0, delayms(1000); goto play;}     //???????,??1?,????????    
       else if(p==0xff)  
	   		{i=i+1;delayms(100),TR0=0; goto a;}  //??????,??100ms,???????    
       else         
			{m=music_tab[i++], n=music_tab[i++];}  //????? ? ????    
       TR0=1;                                             //????1    
       while(n!=0) Beep=~Beep,delay(m);                         //??????, ??P1?????(?????!)    
       TR0=0;                                             //????1    
    }   
}  

